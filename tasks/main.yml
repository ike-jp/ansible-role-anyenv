---
# Include variables and define needed variables.
- name: Include OS-specific variables.
  include_vars: "{{ ansible_os_family }}.yml"

- name: Install anyenv
  git:
    repo: "{{ anyenv_repository_url }}"
    dest: "{{ anyenv_install_dir }}"

- name: Add path to profile
  blockinfile:
    dest: "{{ anyenv_profile_to_add_path }}"
    block: "{{ anyenv_export_text }}"
    insertafter: EOF
  when: anyenv_export

# When added -s option, anyenv will skip the installation.
- name: Install envs
  shell: |
    /bin/bash -lc "source {{ anyenv_profile_to_add_path }}"
    /bin/bash -lc "anyenv install -s {{ item }}"
  register: result
  changed_when: result.stdout != "" and result.stderr != ""
  with_items: "{{ anyenv_installable_env_list }}"
  when: anyenv_install_{{ item }}

- name: Make install a
  shell: |
    echo ""
  with_items: "{{ anyenv_installable_env_list }}"
  register: result

- name: Install language
  shell: |
    /bin/bash -lc "source {{ anyenv_profile_to_add_path }}"
    /bin/bash -lc "{{ item[0] }} {{ item[1] }}"
  with_nested:
    - "{{ anyenv_installable_env_list }}"
    - "anyenv_{{ item[0] }}_installation_versions"


